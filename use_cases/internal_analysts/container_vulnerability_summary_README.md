# Container Vulnerability Summary Script

This script, `container_vulnerability_summary.sh`, is designed to fetch and summarize vulnerability information for a given Red Hat container image. It retrieves CVE (Common Vulnerabilities and Exposures) and RHSA (Red Hat Security Advisories) details associated with the container image and provides a summary including the time intervals between CVE publication, RHSA release, and the next container image rebuild.

## Prerequisites

- Ensure you have `curl` and `jq` installed on your system.
- Ensure you have access to the Red Hat Pyxis API and Red Hat Security Data API.

## Usage

```sh
./container_vulnerability_summary.sh <container-image> [CVE-ID] [RHSA-ID]
```

### Arguments

- `<container-image>`: The container image in the format `registry/namespace/repository:tag` (e.g., `registry.access.redhat.com/ubi8/ubi:latest`).
- `[CVE-ID]` (optional): A specific CVE ID to filter the results.
- `[RHSA-ID]` (optional): A specific RHSA ID to filter the results.

### Example

```sh
./container_vulnerability_summary.sh registry.access.redhat.com/ubi8/ubi:latest
```

## Script Details

### Functions

1. **get_image_metadata(namespace, repository, tag)**:
   - Fetches metadata of the given container image from the Pyxis API.

2. **get_cve_details(cve_id)**:
   - Fetches details of the specified CVE from the Red Hat Security Data API.

3. **get_rhsa_details(rhsa_id)**:
   - Fetches details of the specified RHSA from the Red Hat Security Data API.

4. **get_build_history(namespace, repository)**:
   - Fetches the build history of the specified container image from the Pyxis API.

5. **generate_summary(cve_published_date, rhsa_release_date, build_date)**:
   - Generates a summary of the time intervals between CVE publication, RHSA release, and the next container image rebuild.

### Main Script Execution

1. **Extract Namespace and Repository**:
   - The script extracts the namespace and repository from the provided container image.

2. **Get Image Metadata**:
   - Fetches the image metadata and retrieves the image ID.

3. **Fetch CVEs and RHSAs**:
   - Retrieves CVEs and RHSAs associated with the image.

4. **Get Details for Each CVE and RHSA**:
   - Fetches and prints details for each CVE and RHSA, including their published/release dates and affected releases.

5. **Fetch Build History**:
   - Retrieves the build history of the image and prints it.

6. **Calculate Time Intervals**:
   - Calculates and prints the time intervals between CVE publication, RHSA release, and the next container image rebuild.

### Output

The script prints a detailed summary to the terminal, including:
- Image ID
- List of CVEs with their published dates and affected releases
- List of RHSAs with their release dates
- Build history of the container image
- Time intervals between CVE publication, RHSA release, and container image rebuild

### Example Output

```sh
=== Container Vulnerability Summary ===
Image ID: <image_id>

CVE ID: CVE-2024-XXXX
Published Date: YYYY-MM-DD
Affected Releases:
- Product Name: <product_name>
- Package Version: <package_version>

RHSA ID: RHSA-2024:XXXX
Release Date: YYYY-MM-DD

Build History:
- Build Date: YYYY-MM-DD
- Version: <version>

=== Summary ===
CVE Published Date: YYYY-MM-DD
RHSA Release Date: YYYY-MM-DD
Container Image Rebuilt Date: YYYY-MM-DD
Time from CVE Publication to RHSA Release: X days
Time from RHSA Release to Container Rebuild: X days
```